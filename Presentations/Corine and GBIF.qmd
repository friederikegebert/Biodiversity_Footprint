---
title: "Corine and GBIF trial"
format: pptx
editor: visual
---

{r, echo=F}
library(terra)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(rgbif)
library(tidyverse)
library(leaflet)
library(raster)
library(colorspace)
library(scico)
library(viridis)
library(Polychrome)
library(colorspace)
library(rmarkdown)

{r, echo=F}
germ <- readRDS("germ.rds")
germ <- terra::unwrap(germ)

but_sf_crop_masked <- readRDS("but_sf_crop_masked.rds")

{r, echo=F}

landuse_colors <- c(
  # Urban (reds & purples)
  "Continuous urban fabric" = "#e31a1c",   # strong red
  "Discontinuous urban fabric" = "#fb9a99", 
  "Industrial or commercial units" = "#a63603",
  "Road and rail networks and associated land" = "#fd8d3c",
  "Port areas" = "#6a3d9a", 
  "Airports" = "#cab2d6",
  "Mineral extraction sites" = "#b15928",
  "Dump sites" = "#8c6d31",
  "Construction sites" = "#d9d9d9",
  
  # Urban green & leisure (greens)
  "Green urban areas" = "#66c2a5",
  "Sport and leisure facilities" = "#a6d854",
  
  # Agriculture (yellows & tans)
  "Non-irrigated arable land" = "#ffff99",
  "Vineyards" = "#e6f5c9",
  "Fruit trees and berry plantations" = "#fdbf6f",
  "Pastures" = "#d9ef8b",
  "Complex cultivation patterns" = "#ffed6f",
  "Land principally occupied by agriculture, with significant areas of natural vegetation" = "#bc80bd",
  
  # Forests (greens)
  "Broad-leaved forest" = "#1b9e77",
  "Coniferous forest" = "#00441b",
  "Mixed forest" = "#2ca25f",
  
  # Natural vegetation (greens and browns)
  "Natural grasslands" = "#b2df8a",
  "Moors and heathland" = "#d8b365",
  "Transitional woodland-shrub" = "#8dd3c7",
  
  # Sparsely vegetated (greys and browns)
  "Beaches, dunes, sands" = "#fdd49e",
  "Bare rocks" = "#bdbdbd",
  "Sparsely vegetated areas" = "#e5c494",
  "Glaciers and perpetual snow" = "#f0f0f0",
  
  # Wetlands (blues and turquoises)
  "Inland marshes" = "#a6cee3",
  "Peat bogs" = "#b3cde3",
  "Salt marshes" = "#80b1d3",
  "Intertidal flats" = "#bfd3e6",
  
  # Water (deep blues)
  "Water courses" = "#1f78b4",
  "Water bodies" = "#006d2c",
  "Coastal lagoons" = "#225ea8",
  "Estuaries" = "#253494",
  "Sea and ocean" = "#08306b"
)

lu_ids <- 1:36
lu_labels <- c(
  "Continuous urban fabric", "Discontinuous urban fabric",
  "Industrial or commercial units", "Road and rail networks and associated land",
  "Port areas", "Airports", "Mineral extraction sites", "Dump sites", "Construction sites",
  "Green urban areas", "Sport and leisure facilities", "Non-irrigated arable land",
  "Vineyards", "Fruit trees and berry plantations", "Pastures", "Complex cultivation patterns",
  "Land principally occupied by agriculture, with significant areas of natural vegetation",
  "Broad-leaved forest", "Coniferous forest", "Mixed forest", "Natural grasslands",
  "Moors and heathland", "Transitional woodland-shrub", "Beaches, dunes, sands",
  "Bare rocks", "Sparsely vegetated areas", "Glaciers and perpetual snow", "Inland marshes",
  "Peat bogs", "Salt marshes", "Intertidal flats", "Water courses", "Water bodies",
  "Coastal lagoons", "Estuaries", "Sea and ocean"
)

# Assign factor levels to the raster
levels(germ) <- data.frame(ID = lu_ids, LABEL3 = lu_labels)

# Match colours in correct order
landuse_col_vector <- landuse_colors[lu_labels]


{r, echo=F}

coords <- st_coordinates(but_sf_crop_masked)

Corine land use classes for Germany

{r}

#| label: fig-Corine-landuse
#| fig-cap: "Germany with Corine land use classes."
#| warning: false

layout(matrix(c(1,2), nrow=1), widths = c(5,2))  

# 1) Plot map + points
par(mar = c(2,2,2,1))
plot(germ, col = landuse_col_vector, axes = FALSE, legend = FALSE)
par(mar = c(2,0.5,2,1))  # adjust margins as needed
plot.new()  # start blank plot in second panel
text(x = 0, y = 0.82, labels = "Land use classes", font = 2, cex = 0.9, adj = 0)
legend(x = 0, y = 0.8, legend = lu_labels, fill = landuse_col_vector, cex = 0.6, bty = "n", xpd = TRUE)


Butterflies in Germany

:::: {.columns}

::: {.column width="20%"}

7 families: 

Hesperiidae (Dickkopffalter) 

Papilionidae (Ritterfalter) 

Pieridae (Weißlinge) 

Lycaenidae (Bläulinge) 

Riodinidae (Würfelfalter) 

Nymphalidae (Edelfalter) 

Satyridae (Augenfalter)

429158 features

:::

::: {.column width="80%"}

{r, echo=F}
mar = c(1, 1, 1, 1)
plot(but_sf_crop_masked["species"], pch = 20, col = adjustcolor("#FF1493", 0.3), cex = 0.5)

:::

::::

Butterfly families

{r, echo=F}
families <- c("Hesperiidae", "Papilionidae", "Pieridae", "Lycaenidae", "Riodinidae", "Nymphalidae", "Satyridae")

fam_colors <- c(
  "Hesperiidae" = "#E41A1C",   # rot
  "Papilionidae" = "#377EB8",  # blau
  "Pieridae" = "darkgrey",      # grey
  "Lycaenidae" = "#984EA3",    # lila
  "Riodinidae" = "#FF7F00",    # orange
  "Nymphalidae" = "#A65628",   # braun
  "Satyridae" = "black"      # black
)


par(mfrow = c(3, 3), mar = c(1, 1, 1, 1)) 

for (fam in families) {
  
  # Untermenge nach Familie
  fam_data <- but_sf_crop_masked[but_sf_crop_masked$family == fam, ]
  
  # Plot
  plot(st_geometry(fam_data),
       pch = 20,
       col = adjustcolor(fam_colors[fam], 0.4),
       cex = 0.5,
       main = paste(fam))
}

in case not rendering

{r}

# unlink("Corine and GBIF_files", recursive = TRUE, force = TRUE)
# unlink("Corine and GBIF.pptx", force = TRUE)


